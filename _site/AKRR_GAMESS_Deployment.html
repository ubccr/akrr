<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="utf-8">
  <title>Application Kernel Remote Runner (AKRR) Using &rarr; Adding GAMESS</title>
  <link rel="icon" type="image/x-icon" href="/xdmod-jekyll-theme/assets/images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/xdmod-jekyll-theme/assets/css/effervescence.css" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-44300156-3');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <div id="page-container">
    <div id="page-header">
      <a href="http://open.xdmod.org"><img src="/xdmod-jekyll-theme/assets/images/xdmod_logo.png" alt="XDMoD" /></a>
      <span class="maintitle">Application Kernel Remote Runner (AKRR) Module 2.1.1</span>
    </div>
    
    <div id="page-body">
      <div class="clear"></div>
      <div id="page-menu">
          <div class="page-menu-toc">
        
            
                <h2>About</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/">Overview</a></li>
                            
                    
                    </ul>
                
            
                <h2>Download</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Download.html">Download</a></li>
                            
                    
                    </ul>
                
            
                <h2>Install</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Install.html">Install</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Update.html">Update</a></li>
                            
                    
                    </ul>
                
            
                <h2>Using</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Usage.html">Using</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Add_Resource.html">Adding New Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Deployment_of_Application_Kernel_on_Resource.html">Adding Appkernel to Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NAMD_Deployment.html">Adding NAMD</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCC_Deployment.html">Adding HPCC</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCG_Deployment.html">Adding HPCG</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IMB_Deployment.html">Adding IMB</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IOR_Deployment.html">Adding IOR</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_MDTest_Deployment.html">Adding MDTest</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NWChem_Deployment.html">Adding NWChem</a></li>
                            
                    
                            
                            <li class="active"><a href="/AKRR_GAMESS_Deployment.html">Adding GAMESS</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_ENZO_Deployment.html">Adding ENZO</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Tasks_Scheduling.html">Scheduling Appkernels</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Walltimelimit_Setting.html">Setting AK Walltime</a></li>
                            
                    
                    </ul>
                
            
                <h2>Details</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_HowItWorks.html">How It Works</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Batch_Job_Script_Generation.html">Batch Job Script Generation</a></li>
                            
                    
                    </ul>
                
            
                <h2>Next</h2>
                
                    <ul>
                    
                            
                            <li ><a href="https://appkernels.xdmod.org/">xdmod-appkernels</a></li>
                            
                    
                    </ul>
                
            
        
    </div>
          
        
      </div>
      <div id="page-content">
         <h1>Using &rarr; Adding GAMESS</h1> 
        <h1 id="akrr-deployment-of-gamess-us-application-kernel-on-a-resource">AKRR: Deployment of GAMESS-US Application Kernel on a Resource</h1>

<p><a href="http://www.msg.chem.iastate.edu/gamess/">GAMESS</a> is an ab initio computational chemistry 
software package developed by Professor Mark Gordon’s research group at Iowa State University.</p>

<p>GAMESS applications kernel can be used to 
monitory the performance of system-wide GAMESS installation.</p>

<p>It is also linked against linear algebra library and can use file-system for cache storage. 
Thus it also can work as a probe to monitor performance of these items.</p>

<p>If there is nobody uses GAMESS on your site you can skip it. However, 
unlike benchmarks (HPCC, IOR, IMB) which stress a particular subsystem 
GAMESS application kernel works more like an integrated test and the affects on it can be much milder.</p>

<p>For further convenience of application kernel deployment lets define APPKER and RESOURCE environment 
variable which will contain the HPC resource name:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">RESOURCE</span><span class="o">=</span>&lt;resource_name&gt;
<span class="nb">export </span><span class="nv">APPKER</span><span class="o">=</span>gamess
</code></pre></div></div>

<h1 id="install-application-or-identify-where-it-is-installed">Install Application or Identify where it is Installed</h1>

<p>GAMESS is very often installed system-wide. One of the purposes of application kernels is to monitor 
the performance of application which is used by regular users. If GAMESS is not installed then you 
might need to install this application on your resource or opt to not use it.</p>

<p>Majority of HPC resources utilize some kind of module system. Execute it and see is GAMESS already 
installed</p>

<p><strong>On resource</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module avail gamess
</code></pre></div></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------------------------- /util/academic/modulefiles/Core ------------------------------------
   gamess/5dec2014R1-ddi    gamess/5dec2014R1    gamess/11Nov2017R3    gamess/18Aug2016R1 (D)

</code></pre></div></div>

<p>We’ll use gamess/11Nov2017R3. Running GAMESS is somewhat different from other application. We need to find
binary location and its version. <code class="language-plaintext highlighter-rouge">module show</code> whould have some information</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module show gamess/11Nov2017R3
</code></pre></div></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whatis(" GAMESS")
prepend_path("PATH","/util/academic/gamess/11Nov2017R3/impi/gamess")
load("intel/18.1")
load("intel-mpi/2018.1")
load("mkl/2018.1")
</code></pre></div></div>
<p>By checking path prepended directory:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> /util/academic/gamess/11Nov2017R3/impi/gamess
</code></pre></div></div>
<p>we can find executable is gamess.01.x and it lives in /util/academic/gamess/11Nov2017R3/impi/gamess and 
version number is 01 (whatever characters between dots in gamess.01.x).</p>

<p>GAMESS is started with rungms script and it needed to be changed almost always, usually for scratch locations. 
GAMESS stores there final results and in case of rerun (which is AKRR intention) it would not run.</p>

<p>Copy rungms to app kernel directory on remote resource:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># AKRR_APPKER_DIR should be initiated in .bashrc and placed there during initial deployment on resource</span>
<span class="nb">cd</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs
<span class="nb">mkdir </span>gamess
<span class="nb">cd </span>gamess
<span class="nb">cp</span> /util/academic/gamess/11Nov2017R3/impi/gamess/rungms ./
</code></pre></div></div>

<p>Set SCR and USERSCR to <code class="language-plaintext highlighter-rouge">pwd</code> in your copy of rungms (located in the begining of script):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">set </span><span class="nv">SCR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
<span class="nb">set </span><span class="nv">USERSCR</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
</code></pre></div></div>
<p>AKRR starts GAMESS from temporary directory and it is deleted after downloading results.</p>

<h1 id="generate-initiate-configuration-file">Generate Initiate Configuration File</h1>

<p>Generate Initiate Configuration File:</p>

<p><strong>On AKRR server</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr app add <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-r</span> <span class="nv">$RESOURCE</span>
</code></pre></div></div>
<p>Sample output:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[INFO] Generating application kernel configuration for gamess on ub-hpc
[INFO] Application kernel configuration for gamess on ub-hpc is in: 
        /home/akrruser/akrr/etc/resources/ub-hpc/gamess.app.conf
</code></pre></div></div>

<h1 id="edit-configuration-file">Edit Configuration File</h1>

<p>Below is listing of example configuration file located at ~/akrr/etc/resources/$RESOURCE/gamess.app.conf</p>

<p><strong>~/akrr/etc/resources/$RESOURCE/gamess.app.conf</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">appkernel_run_env_template</span> <span class="o">=</span> <span class="s">"""
# Load application enviroment
module load gamess
module list

# set executable location
VERNO=01
EXE=$GAMESS_DIR/gamess.$VERNO.x

# set how to run app kernel
RUN_APPKERNEL="$AKRR_APPKER_DIR/execs/gamess/rungms $INPUT $VERNO $AKRR_CORES"
"""</span>
</code></pre></div></div>

<p>It contain only one parameter <em>appkernel_run_env_template</em> which need to be edited:</p>

<p>1) First part is “Load application environment”, here you need to set proper enviroment. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Load application environment</span>
module load gamess/11Nov2017R3
module list
</code></pre></div></div>

<p>2) Second part is “set executable location”, it set the location of executables absolute path to 
gamess should be placed to EXE variable (application signature will be calculated for that 
executable) as well as version (VERNO). Use values which we find earlier. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># set executable location</span>
<span class="nv">VERNO</span><span class="o">=</span>01
<span class="nv">EXE</span><span class="o">=</span>/util/academic/gamess/11Nov2017R3/impi/gamess/gamess.<span class="nv">$VERNO</span>.x
</code></pre></div></div>

<p>3)Fourth part is “set how to run app kernel”, it set RUN_APPKERNEL, which specify how to execute GAMESS:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Set how to ran app kernel</span>
<span class="nv">RUN_APPKERNEL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$AKRR_APPKER_DIR</span><span class="s2">/execs/gamess/rungms </span><span class="nv">$INPUT</span><span class="s2"> </span><span class="nv">$VERNO</span><span class="s2"> </span><span class="nv">$AKRR_NODES</span><span class="s2"> </span><span class="nv">$AKRR_CORES_PER_NODE</span><span class="s2">"</span>
</code></pre></div></div>
<p>Most likely you don’t need to modify anything here, just ensure that <code class="language-plaintext highlighter-rouge">rungms</code> refer to your 
version which was modified earlied..</p>

<h1 id="generate-batch-job-script-and-execute-it-manually-optional">Generate Batch Job Script and Execute it Manually (Optional) </h1>

<p>The purpose of this step is to ensure that the configuration lead to correct workable batch job 
script. Here, at first batch job script is generated with ‘akrr_ctl.sh batch_job’. Then this script 
is executed in interactive session (this improves the turn-around in case of errors). If script 
fails to execute, the issues can be fixed first in that script itself and then merged to 
configuration file.</p>

<p>This step is somewhat optional because it is very similar to next step. However the opportunity to 
work in interactive session improve turn-around time because there is no need to stay in queue for 
each iteration.</p>

<p>First generate the script to standard output and examine it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr task new <span class="nt">--dry-run</span> <span class="nt">--gen-batch-job-only</span> <span class="nt">-n</span> 2 <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span>
</code></pre></div></div>

<p><strong>Portion of “<em>akrr task new –dry-run –gen-batch-job-only -n 2 -r $RESOURCE -a $APPKER</em>” output showing generated 
batch script</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#SBATCH --partition=general-compute </span>
<span class="c">#SBATCH --qos=general-compute</span>
<span class="c">#SBATCH --nodes=2</span>
<span class="c">#SBATCH --ntasks-per-node=8</span>
<span class="c">#SBATCH --time=00:20:00</span>
<span class="c">#SBATCH --output=/projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.03.58.405597/stdout</span>
<span class="c">#SBATCH --error=/projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.03.58.405597/stderr</span>
<span class="c">#SBATCH --constraint="CPU-L5520"</span>
<span class="c">#SBATCH --exclusive</span>


<span class="c">#Common commands</span>
<span class="nb">export </span><span class="nv">AKRR_NODES</span><span class="o">=</span>2
<span class="nb">export </span><span class="nv">AKRR_CORES</span><span class="o">=</span>16
<span class="nb">export </span><span class="nv">AKRR_CORES_PER_NODE</span><span class="o">=</span>8
<span class="nb">export </span><span class="nv">AKRR_NETWORK_SCRATCH</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/tmp"</span>
<span class="nb">export </span><span class="nv">AKRR_LOCAL_SCRATCH</span><span class="o">=</span><span class="s2">"/tmp"</span>
<span class="nb">export </span><span class="nv">AKRR_TASK_WORKDIR</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.03.58.405597"</span>
<span class="nb">export </span><span class="nv">AKRR_APPKER_DIR</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/appker"</span>
<span class="nb">export </span><span class="nv">AKRR_AKRR_DIR</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/akrr_data"</span>

<span class="nb">export </span><span class="nv">AKRR_APPKER_NAME</span><span class="o">=</span><span class="s2">"gamess"</span>
<span class="nb">export </span><span class="nv">AKRR_RESOURCE_NAME</span><span class="o">=</span><span class="s2">"ub-hpc"</span>
<span class="nb">export </span><span class="nv">AKRR_TIMESTAMP</span><span class="o">=</span><span class="s2">"2019.04.29.20.03.58.405597"</span>
<span class="nb">export </span><span class="nv">AKRR_APP_STDOUT_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$AKRR_TASK_WORKDIR</span><span class="s2">/appstdout"</span>

<span class="nb">export </span><span class="nv">AKRR_APPKERNEL_INPUT</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/appker/inputs/gamess/c8h10-cct-mp2.inp"</span>
<span class="nb">export </span><span class="nv">AKRR_APPKERNEL_EXECUTABLE</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/appker/execs"</span>

<span class="nb">source</span> <span class="s2">"</span><span class="nv">$AKRR_APPKER_DIR</span><span class="s2">/execs/bin/akrr_util.bash"</span>

<span class="c">#Populate list of nodes per MPI process</span>
<span class="nb">export </span><span class="nv">AKRR_NODELIST</span><span class="o">=</span><span class="sb">`</span>srun <span class="nt">-l</span> <span class="nt">--ntasks-per-node</span><span class="o">=</span><span class="nv">$AKRR_CORES_PER_NODE</span> <span class="nt">-n</span> <span class="nv">$AKRR_CORES</span> <span class="nb">hostname</span> <span class="nt">-s</span>|sort <span class="nt">-n</span>| <span class="nb">awk</span> <span class="s1">'{printf "%s ",$2}'</span> <span class="sb">`</span>

<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$AKRR_APPKER_DIR</span><span class="s2">/execs/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$AKRR_TASK_WORKDIR</span><span class="s2">"</span>

<span class="c">#run common tests</span>
akrr_perform_common_tests

<span class="c">#Write some info to gen.info, JSON-Like file</span>
akrr_write_to_gen_info <span class="s2">"start_time"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">"</span>
akrr_write_to_gen_info <span class="s2">"node_list"</span> <span class="s2">"</span><span class="nv">$AKRR_NODELIST</span><span class="s2">"</span>


<span class="c">#create working dir</span>
<span class="nb">export </span><span class="nv">AKRR_TMP_WORKDIR</span><span class="o">=</span><span class="sb">`</span><span class="nb">mktemp</span> <span class="nt">-d</span> /projects/ccrstaff/general/nikolays/huey/tmp/gamess.XXXXXXXXX<span class="sb">`</span>
<span class="nb">echo</span> <span class="s2">"Temporary working directory: </span><span class="nv">$AKRR_TMP_WORKDIR</span><span class="s2">"</span>
<span class="nb">cd</span> <span class="nv">$AKRR_TMP_WORKDIR</span>

<span class="c">#Copy inputs</span>
<span class="nb">cp</span> /projects/ccrstaff/general/nikolays/huey/appker/inputs/gamess/c8h10-cct-mp2.inp ./
<span class="nv">INPUT</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> /projects/ccrstaff/general/nikolays/huey/appker/inputs/gamess/c8h10-cct-mp2.inp | xargs <span class="nb">basename</span> <span class="si">)</span>



<span class="c">#Load application enviroment</span>
module load gamess/11Nov2017R3
module list

<span class="c">#set executable location</span>
<span class="nv">VERNO</span><span class="o">=</span>01
<span class="nv">EXE</span><span class="o">=</span>/util/academic/gamess/11Nov2017R3/impi/gamess/gamess.<span class="nv">$VERNO</span>.x

<span class="c">#set how to run app kernel</span>
<span class="nv">RUN_APPKERNEL</span><span class="o">=</span><span class="s2">"</span><span class="nv">$AKRR_APPKER_DIR</span><span class="s2">/execs/gamess/rungms </span><span class="nv">$INPUT</span><span class="s2"> </span><span class="nv">$VERNO</span><span class="s2"> </span><span class="nv">$AKRR_NODES</span><span class="s2"> </span><span class="nv">$AKRR_CORES_PER_NODE</span><span class="s2">"</span>


<span class="c">#Generate AppKer signature</span>
appsigcheck.sh <span class="nv">$EXE</span> <span class="nv">$AKRR_TASK_WORKDIR</span>/.. <span class="o">&gt;</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span>


<span class="nv">ATTEMPTS_TO_LAUNCH</span><span class="o">=</span>0
<span class="k">while</span> <span class="o">!</span> <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"EXECUTION OF GAMESS TERMINATED NORMALLY"</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span>
<span class="k">do
    </span><span class="nb">echo</span> <span class="s2">"Attempt to launch GAMESS: </span><span class="nv">$ATTEMPTS_TO_LAUNCH</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span> 2&gt;&amp;1
    <span class="nb">echo</span> <span class="s2">"Attempt to launch GAMESS: </span><span class="nv">$ATTEMPTS_TO_LAUNCH</span><span class="s2">"</span>
    <span class="nb">rm</span> <span class="nt">-rf</span> <span class="k">*</span>
    <span class="nb">mkdir </span>scr
    <span class="nb">mkdir </span>supout
    <span class="nb">cp</span> /projects/ccrstaff/general/nikolays/huey/appker/inputs/gamess/c8h10-cct-mp2.inp ./
    <span class="nv">$RUN_APPKERNEL</span> <span class="o">&gt;&gt;</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span> 2&gt;&amp;1
    
    <span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$ATTEMPTS_TO_LAUNCH</span><span class="s2">"</span> <span class="nt">-ge</span> 6 <span class="o">]</span><span class="p">;</span> <span class="k">then
        </span><span class="nb">break
    </span><span class="k">fi</span>
    
    <span class="o">((</span>ATTEMPTS_TO_LAUNCH++<span class="o">))</span>
<span class="k">done
</span>akrr_write_to_gen_info <span class="s2">"attemptsToLaunch"</span> <span class="s2">"</span><span class="nv">$ATTEMPTS_TO_LAUNCH</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"Total attempt to launch GAMESS is </span><span class="nv">$ATTEMPTS_TO_LAUNCH</span><span class="s2">"</span>




<span class="c">#clean-up</span>
<span class="nb">cd</span> <span class="nv">$AKRR_TASK_WORKDIR</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AKRR_DEBUG</span><span class="p">=no</span><span class="k">}</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"no"</span> <span class="o">]</span>
<span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Deleting temporary files"</span>
        <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$AKRR_TMP_WORKDIR</span>
<span class="k">else
        </span><span class="nb">echo</span> <span class="s2">"Copying temporary files"</span>
        <span class="nb">cp</span> <span class="nt">-r</span> <span class="nv">$AKRR_TMP_WORKDIR</span> workdir
        <span class="nb">rm</span> <span class="nt">-rf</span> <span class="nv">$AKRR_TMP_WORKDIR</span>
<span class="k">fi



</span>akrr_write_to_gen_info <span class="s2">"end_time"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">"</span>

</code></pre></div></div>

<p>Next generate the script on resource:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr task new <span class="nt">--gen-batch-job-only</span> <span class="nt">-n</span> 2 <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span>
</code></pre></div></div>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[INFO] Creating task directory: /home/akrruser/akrr/log/data/ub-hpc/gamess/2019.04.29.20.04.39.697226
[INFO] Creating task directories: 
        /home/akrruser/akrr/log/data/ub-hpc/gamess/2019.04.29.20.04.39.697226/jobfiles
        /home/akrruser/akrr/log/data/ub-hpc/gamess/2019.04.29.20.04.39.697226/proc
[INFO] Creating batch job script and submitting it to remote machine
[INFO] Directory huey:/projects/ccrstaff/general/nikolays/huey/akrr_data/gamess does not exists, will try to create it
[INFO] Directory huey:/projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.04.39.697226 does not exists, will try to create it
[INFO] auto_walltime_limit is on, trying to estimate walltime limit...
[INFO] There are only 0 previous run, need at least 5 for walltime limit autoset
[INFO] Local copy of batch job script is /home/akrruser/akrr/log/data/ub-hpc/gamess/2019.04.29.20.04.39.697226/jobfiles/gamess.job

[INFO] Application kernel working directory on ub-hpc is /projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.04.39.697226
[INFO] Batch job script location on ub-hpc is /projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.04.39.697226/gamess.job
</code></pre></div></div>

<p>The output contains the working directory for this task on remote resource. On remote resource get 
to that directory and start interactive session (request same number of nodes, in example above the 
script was generated for 2 nodes).</p>

<p><strong>On remote resource</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#get to working directory</span>
<span class="nb">cd</span> /projects/ccrstaff/general/nikolays/huey/akrr_data/gamess/2019.04.29.20.04.39.697226
<span class="c">#check hpcc.job is there</span>
<span class="nb">ls</span>
<span class="c">#start interactive session</span>
salloc <span class="nt">--nodes</span><span class="o">=</span>2 <span class="nt">--ntasks-per-node</span><span class="o">=</span>8 <span class="nt">--time</span><span class="o">=</span>01:00:00 <span class="nt">--exclusive</span> <span class="nt">--constraint</span><span class="o">=</span><span class="s2">"CPU-L5520"</span>
<span class="c">#wait till you get access to interactive session</span>
<span class="c">#run ior application kernel</span>
bash gamess.job

<span class="c"># or submit as normal batch script</span>
sbatch gamess.job

<span class="c">#examine output</span>
<span class="nb">cat </span>appstdout
</code></pre></div></div>

<p>Examine appstdout file, which contains application kernel output (<a href="/AKRR_GAMESS_appsout_sample.html">appstdout sample</a>). 
If it looks ok you can move to the next step</p>

<h1 id="perform-validation-run">Perform Validation Run</h1>

<p>On this step appkernel_validation.py utility is used to validate application kernel installation on 
particular resource. It execute application kernel and analyses its’ results. If it fails the 
problems need to be fixed and another round of validation should be performed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr app validate <span class="nt">-n</span> 2 <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> 
</code></pre></div></div>

<p>See <a href="/AKRR_GAMESS_appkernel_validation_sample.html">validation output sample</a></p>

<h1 id="schedule-regular-execution-of-application-kernel">Schedule regular execution of application kernel.</h1>

<p>Now this application kernel can be submitted for regular execution:</p>

<h1 id="perform-a-test-run-on-all-nodes-count">Perform a test run on all nodes count</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Perform a test run on all nodes count</span>
akrr task new <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-n</span> 1,2,4,8

<span class="c">#Start daily execution from today on nodes 1,2,4,8 and distribute execution time between 1:00 and 5:00</span>
akrr task new <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-n</span> 1,2,4,8 <span class="nt">-t0</span> <span class="s2">"01:00"</span> <span class="nt">-t1</span> <span class="s2">"05:00"</span> <span class="nt">-p</span> 1

<span class="c"># Run on all nodes count 20 times (default number of runs to establish baseline)</span>
akrr task new <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-n</span> 1,2,4,8 <span class="nt">--n-runs</span> 20
</code></pre></div></div>

<p>see <a href="/AKRR_Tasks_Scheduling.html">Scheduling and Rescheduling Application Kernels</a> and 
<a href="/AKRR_Walltimelimit_Setting.html">Setup Walltime Limit</a> for more details.</p>

<p>Up: <a href="/AKRR_Deployment_of_Application_Kernel_on_Resource.html">Deployment of Application Kernels on Resource</a></p>

      </div>
      <div class="clear"></div>
    </div>
    <div id="page-footer">
      <a href="https://www.buffalo.edu/ccr" target="_blank"><img src="/xdmod-jekyll-theme/assets/images/ccr_logo.png" alt="Center for Computational Research"/></a>
    </div>
  </div>
</body>
</html>
