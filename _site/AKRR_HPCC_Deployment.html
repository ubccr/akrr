<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="utf-8">
  <title>Application Kernel Remote Runner (AKRR) Using &rarr; Adding HPCC</title>
  <link rel="icon" type="image/x-icon" href="/xdmod-jekyll-theme/assets/images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/xdmod-jekyll-theme/assets/css/effervescence.css" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-44300156-3');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <div id="page-container">
    <div id="page-header">
      <a href="http://open.xdmod.org"><img src="/xdmod-jekyll-theme/assets/images/xdmod_logo.png" alt="XDMoD" /></a>
      <span class="maintitle">Application Kernel Remote Runner (AKRR) Module 2.1.1</span>
    </div>
    
    <div id="page-body">
      <div class="clear"></div>
      <div id="page-menu">
          <div class="page-menu-toc">
        
            
                <h2>About</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/">Overview</a></li>
                            
                    
                    </ul>
                
            
                <h2>Download</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Download.html">Download</a></li>
                            
                    
                    </ul>
                
            
                <h2>Install</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Install.html">Install</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Update.html">Update</a></li>
                            
                    
                    </ul>
                
            
                <h2>Using</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Usage.html">Using</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Add_Resource.html">Adding New Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Deployment_of_Application_Kernel_on_Resource.html">Adding Appkernel to Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NAMD_Deployment.html">Adding NAMD</a></li>
                            
                    
                            
                            <li class="active"><a href="/AKRR_HPCC_Deployment.html">Adding HPCC</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCG_Deployment.html">Adding HPCG</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IMB_Deployment.html">Adding IMB</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IOR_Deployment.html">Adding IOR</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_MDTest_Deployment.html">Adding MDTest</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NWChem_Deployment.html">Adding NWChem</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_GAMESS_Deployment.html">Adding GAMESS</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_ENZO_Deployment.html">Adding ENZO</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Tasks_Scheduling.html">Scheduling Appkernels</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Walltimelimit_Setting.html">Setting AK Walltime</a></li>
                            
                    
                    </ul>
                
            
                <h2>Details</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_HowItWorks.html">How It Works</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Batch_Job_Script_Generation.html">Batch Job Script Generation</a></li>
                            
                    
                    </ul>
                
            
                <h2>Next</h2>
                
                    <ul>
                    
                            
                            <li ><a href="https://appkernels.xdmod.org/">xdmod-appkernels</a></li>
                            
                    
                    </ul>
                
            
        
    </div>
          
        
      </div>
      <div id="page-content">
         <h1>Using &rarr; Adding HPCC</h1> 
        <h1 id="akrr-deployment-of-hpcc-applications-kernels-on-a-resource">AKRR: Deployment of HPCC Applications Kernels on a Resource</h1>

<p>HPCC benchmark have a number of tests including linear algebra and memory benchmark which are good to monitore 
the performance of CPU compute power and memory. Because HPCC is linked with liner algebra and fast Fourier 
transformations  library. HPCC application kernel also monitor performance of respective libraries.</p>

<p>For simplicity lets define APPKER and RESOURCE environment variables which will contain the HPC 
resource name:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">RESOURCE</span><span class="o">=</span>&lt;resource_name&gt;
<span class="nb">export </span><span class="nv">APPKER</span><span class="o">=</span>hpcc
</code></pre></div></div>

<h1 id="installing-hpcc">Installing HPCC</h1>

<p>In this section example of HPCC installation on HPC resource will be described, see also HPCC benchmark 
documentation for more installation details 
(<a href="http://icl.cs.utk.edu/hpcc/">http://icl.cs.utk.edu/hpcc/</a>).</p>

<p>** on HPC resource**</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Go to Application Kernel executable directory</span>
<span class="nb">cd</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs
<span class="c"># Environment variable $AKRR_APPKER_DIR should be setup automatically during initial</span>
<span class="c"># deployment to HPC resource</span>

<span class="c"># Load modules</span>
module load intel/18.3
module load intel-mpi/2018.3
module load mkl/2018.3
 
<span class="c"># We need to make bench of interfaces to mkl library, unfortunately they are not precompiled</span>
<span class="c"># Lets compile them in $AKRR_APPKER_DIR/execs/libs/&lt;interface_name&gt;</span>
<span class="c"># and install in $AKRR_APPKER_DIR/execs/libs/lib</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs/libs
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs/libs/lib

<span class="c"># make fftw2x_cdft interface to mkl</span>
<span class="nb">cd</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs/libs
<span class="nb">cp</span> <span class="nt">-r</span> <span class="nv">$MKLROOT</span>/interfaces/fftw2x_cdft ./
<span class="nb">cd </span>fftw2x_cdft
make libintel64 <span class="nv">PRECISION</span><span class="o">=</span>MKL_DOUBLE <span class="nv">interface</span><span class="o">=</span>ilp64 <span class="nv">MKLROOT</span><span class="o">=</span><span class="nv">$MKLROOT</span> <span class="nv">INSTALL_DIR</span><span class="o">=</span><span class="nv">$AKRR_APPKER_DIR</span>/execs/libs/lib


<span class="c"># make FFTW C wrapper library</span>
<span class="nb">cd</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs/libs
<span class="nb">cp</span> <span class="nt">-r</span> <span class="nv">$MKLROOT</span>/interfaces/fftw2xc ./
<span class="nb">cd </span>fftw2xc
make libintel64 <span class="nv">PRECISION</span><span class="o">=</span>MKL_DOUBLE <span class="nv">MKLROOT</span><span class="o">=</span><span class="nv">$MKLROOT</span> <span class="nv">INSTALL_DIR</span><span class="o">=</span><span class="nv">$AKRR_APPKER_DIR</span>/execs/libs/lib

 
<span class="c"># get the code</span>
<span class="nb">cd</span> <span class="nv">$AKRR_APPKER_DIR</span>/execs
wget http://icl.cs.utk.edu/projectsfiles/hpcc/download/hpcc-1.5.0.tar.gz
<span class="nb">tar </span>xvzf hpcc-1.5.0.tar.gz
<span class="nb">cd </span>hpcc-1.5.0
<span class="c"># Prepare makefile</span>
<span class="c"># HPCC reuses makefiles from High Performance Linpack (thus do not forget to get to hpc directory)</span>
<span class="c"># you can start with something close from hpl/setup directory</span>
<span class="c"># or start from one of our make file</span>
<span class="c"># place Make.intel64_hpcresource file to hpcc-1.4.2/hpl</span>
<span class="nb">cd </span>hpl

wget https://raw.githubusercontent.com/ubccr/akrr/master/akrr/appker_repo/execs/misc/hpcc/Make.intel64_hpcresource
<span class="c"># edit Make.intel64_hpcresource to fit your system </span>
<span class="c"># if you have intel based system with intel compilers and intel-mpi</span>
<span class="c"># most likely you don't need to change it</span>
 
<span class="c"># compile hpcc in hpcc-1.4.2 root directory</span>
<span class="nb">cd</span> ..
make <span class="nb">arch</span><span class="o">=</span>intel64_hpcresource
<span class="c"># if it is compiled successfully hpcc binary should appear in hpcc-1.4.2 directory</span>


<span class="c"># create hpcc link to hpcc-1.5.0</span>
<span class="nb">cd</span> ..
<span class="nb">ln</span> <span class="nt">-s</span> hpcc-1.5.0 hpcc
 

 
<span class="c"># now we can test it on headnode (optional)</span>
<span class="nb">cd </span>hpcc
<span class="nb">mv </span>_hpccinf.txt hpccinf.txt

mpirun <span class="nt">-np</span> 4 ./hpcc
<span class="nb">cat </span>hpccoutf.txt
</code></pre></div></div>

<h1 id="generate-initiate-configuration-file">Generate Initiate Configuration File</h1>

<p>Generate Initiate Configuration File:</p>

<p><strong>On AKRR server</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr app add <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-r</span> <span class="nv">$RESOURCE</span>
</code></pre></div></div>
<p>Sample output:</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[INFO] Generating application kernel configuration for hpcc on ub-hpc
[INFO] Application kernel configuration for hpcc on ub-hpc is in: 
        /home/akrruser/akrr/etc/resources/ub-hpc/hpcc.app.conf
</code></pre></div></div>

<h1 id="edit-configuration-file">Edit Configuration File</h1>

<p>Below is a listing of configuration file located at 
~/akrr/etc/resources/$RESOURCE/hpcc.app.conf for SLURM:</p>

<p><strong>initial ~/akrr/etc/resources/$RESOURCE/hpcc.app.conf</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">appkernel_run_env_template</span> <span class="o">=</span> <span class="s">"""
# Load application environment
module load intel
module load intel-mpi
module load mkl
module list

# make srun works with intel mpi
export I_MPI_PMI_LIBRARY=/usr/lib64/libpmi.so

# set how to run app kernel
RUN_APPKERNEL="srun {appkernel_dir}/{executable}"
"""</span>
<span class="c1"># gflops: 2 for number of units * 2 for FMA * 8 for data width * 1.9 for frequency 
</span><span class="n">theoretical_gflops_per_core</span> <span class="o">=</span> <span class="bp">None</span>
</code></pre></div></div>

<p>In the previous AKRR version we calculate theoretical GFLOPs on the fly based on frequencies measured
after HPCC execution. Nowadays frequencies are tricky and it is difficult to calculate theoretical GFLOPs for
all possible CPUs so now you need to do it your self. For Intel CPUs sustainable frequencies for different execution mode
can be found in https://www.intel.com/content/www/us/en/processors/xeon/scalable/xeon-scalable-spec-update.html .</p>

<p>Here is some examples for different CPUs</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Intel CPU Gold 6130</span>
<span class="c"># frequency for avx512 load on all cores: 1.9 GHz</span>
<span class="c"># fused multiply add: yes</span>
<span class="c"># data width: 8 doubles</span>
<span class="c"># vector arithmetics units: 2</span>
<span class="c"># gflops: 2 for number of units * 2 for FMA * 8 for data width * 1.9 for frequency </span>
theoretical_gflops_per_core <span class="o">=</span> 2 <span class="k">*</span> 2 <span class="k">*</span> 8 <span class="k">*</span> 1.9
</code></pre></div></div>

<p>Update loading environment variables and theoretical_gflops_per_core. The way how hpcc is executed:</p>

<p><strong>~/akrr/etc/resources/$RESOURCE/hpcc.app.conf</strong></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">appkernel_run_env_template</span> <span class="o">=</span> <span class="s">"""
# Load application environment
module load intel/18.3
module load intel-mpi/2018.3
module load mkl/2018.3
module list

# make srun works with intel mpi
export I_MPI_PMI_LIBRARY=/usr/lib64/libpmi.so

# set how to run app kernel
RUN_APPKERNEL="srun {appkernel_dir}/{executable}"
"""</span>
</code></pre></div></div>

<h1 id="generate-batch-job-script-and-execute-it-manually-optional">Generate Batch Job Script and Execute it Manually (Optional)</h1>

<p>The purpose of this step is to ensure that the configuration lead to correct workable batch job 
script. Here first batch job script is generated with ‘akrr_ctl.sh batch_job’. Then this script is 
executed in interactive session (this improves the turn-around in case of errors). If script fails 
to execute, the issues can be fixed first in that script itself and then merged to configuration 
file.</p>

<p>This step is somewhat optional because it is very similar to next step. However the opportunity to 
work in interactive session improve turn-around time because there is no need to stay in queue for 
each iteration.</p>

<p>First generate the script to standard output and examine it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr task new <span class="nt">--dry-run</span> <span class="nt">--gen-batch-job-only</span> <span class="nt">-n</span> 2 <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span>
</code></pre></div></div>

<p><strong>Portion of “<em>akrr task new –dry-run –gen-batch-job-only -n 2 -r $RESOURCE -a $APPKER</em>” output showing generated 
batch script</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#SBATCH --partition=general-compute </span>
<span class="c">#SBATCH --qos=general-compute</span>
<span class="c">#SBATCH --nodes=2</span>
<span class="c">#SBATCH --ntasks-per-node=8</span>
<span class="c">#SBATCH --time=00:40:00</span>
<span class="c">#SBATCH --output=/projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.00.23.886859/stdout</span>
<span class="c">#SBATCH --error=/projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.00.23.886859/stderr</span>
<span class="c">#SBATCH --constraint="CPU-L5520"</span>
<span class="c">#SBATCH --exclusive</span>


<span class="c">#Common commands</span>
<span class="nb">export </span><span class="nv">AKRR_NODES</span><span class="o">=</span>2
<span class="nb">export </span><span class="nv">AKRR_CORES</span><span class="o">=</span>16
<span class="nb">export </span><span class="nv">AKRR_CORES_PER_NODE</span><span class="o">=</span>8
<span class="nb">export </span><span class="nv">AKRR_NETWORK_SCRATCH</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/tmp"</span>
<span class="nb">export </span><span class="nv">AKRR_LOCAL_SCRATCH</span><span class="o">=</span><span class="s2">"/tmp"</span>
<span class="nb">export </span><span class="nv">AKRR_TASK_WORKDIR</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.00.23.886859"</span>
<span class="nb">export </span><span class="nv">AKRR_APPKER_DIR</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/appker"</span>
<span class="nb">export </span><span class="nv">AKRR_AKRR_DIR</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/akrr_data"</span>

<span class="nb">export </span><span class="nv">AKRR_APPKER_NAME</span><span class="o">=</span><span class="s2">"hpcc"</span>
<span class="nb">export </span><span class="nv">AKRR_RESOURCE_NAME</span><span class="o">=</span><span class="s2">"ub-hpc"</span>
<span class="nb">export </span><span class="nv">AKRR_TIMESTAMP</span><span class="o">=</span><span class="s2">"2019.03.25.16.00.23.886859"</span>
<span class="nb">export </span><span class="nv">AKRR_APP_STDOUT_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$AKRR_TASK_WORKDIR</span><span class="s2">/appstdout"</span>

<span class="nb">export </span><span class="nv">AKRR_APPKERNEL_INPUT</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/appker/inputs/hpcc/hpccinf.txt.8x2"</span>
<span class="nb">export </span><span class="nv">AKRR_APPKERNEL_EXECUTABLE</span><span class="o">=</span><span class="s2">"/projects/ccrstaff/general/nikolays/huey/appker/execs/hpcc/hpcc"</span>

<span class="nb">source</span> <span class="s2">"</span><span class="nv">$AKRR_APPKER_DIR</span><span class="s2">/execs/bin/akrr_util.bash"</span>

<span class="c">#Populate list of nodes per MPI process</span>
<span class="nb">export </span><span class="nv">AKRR_NODELIST</span><span class="o">=</span><span class="sb">`</span>srun <span class="nt">-l</span> <span class="nt">--ntasks-per-node</span><span class="o">=</span><span class="nv">$AKRR_CORES_PER_NODE</span> <span class="nt">-n</span> <span class="nv">$AKRR_CORES</span> <span class="nb">hostname</span> <span class="nt">-s</span>|sort <span class="nt">-n</span>| <span class="nb">awk</span> <span class="s1">'{printf "%s ",$2}'</span> <span class="sb">`</span>

<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$AKRR_APPKER_DIR</span><span class="s2">/execs/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

<span class="nb">cd</span> <span class="s2">"</span><span class="nv">$AKRR_TASK_WORKDIR</span><span class="s2">"</span>

<span class="c">#run common tests</span>
akrr_perform_common_tests

<span class="c">#Write some info to gen.info, JSON-Like file</span>
akrr_write_to_gen_info <span class="s2">"start_time"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">"</span>
akrr_write_to_gen_info <span class="s2">"node_list"</span> <span class="s2">"</span><span class="nv">$AKRR_NODELIST</span><span class="s2">"</span>


<span class="c">#create working dir</span>
<span class="nb">mkdir </span>workdir
<span class="nb">cd </span>workdir

<span class="c">#Copy inputs</span>
<span class="nb">cp</span> /projects/ccrstaff/general/nikolays/huey/appker/inputs/hpcc/hpccinf.txt.8x2 ./hpccinf.txt

<span class="nv">EXE</span><span class="o">=</span>/projects/ccrstaff/general/nikolays/huey/appker/execs/hpcc/hpcc



<span class="c"># Load application environment</span>
module load intel/18.3
module load intel-mpi/2018.3
module load mkl/2018.3
module list

<span class="c"># make srun works with intel mpi</span>
<span class="nb">export </span><span class="nv">I_MPI_PMI_LIBRARY</span><span class="o">=</span>/usr/lib64/libpmi.so

<span class="c"># set how to run app kernel</span>
<span class="nv">RUN_APPKERNEL</span><span class="o">=</span><span class="s2">"srun /projects/ccrstaff/general/nikolays/huey/appker/execs/hpcc/hpcc"</span>


<span class="c">#Generate AppKer signature</span>
appsigcheck.sh <span class="nv">$EXE</span> <span class="nv">$AKRR_TASK_WORKDIR</span>/.. <span class="o">&gt;</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span>


<span class="c">#Execute AppKer</span>
akrr_write_to_gen_info <span class="s2">"appkernel_start_time"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">"</span>
<span class="nv">$RUN_APPKERNEL</span> <span class="o">&gt;&gt;</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span> 2&gt;&amp;1
akrr_write_to_gen_info <span class="s2">"appkernel_end_time"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">"</span>




<span class="nb">cat </span>hpccoutf.txt  <span class="o">&gt;&gt;</span> <span class="nv">$AKRR_APP_STDOUT_FILE</span> 2&gt;&amp;1

<span class="nb">cd</span> ..

akrr_write_to_gen_info <span class="s2">"cpu_speed"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">grep</span> <span class="s1">'cpu MHz'</span> /proc/cpuinfo<span class="sb">`</span><span class="s2">"</span>

<span class="c">#clean-up</span>
<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">AKRR_DEBUG</span><span class="p">=no</span><span class="k">}</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"no"</span> <span class="o">]</span>
<span class="k">then
        </span><span class="nb">echo</span> <span class="s2">"Deleting input files"</span>
        <span class="nb">rm</span> <span class="nt">-rf</span> workdir
<span class="k">fi



</span>akrr_write_to_gen_info <span class="s2">"end_time"</span> <span class="s2">"</span><span class="sb">`</span><span class="nb">date</span><span class="sb">`</span><span class="s2">"</span>
</code></pre></div></div>

<p>Next generate the script on resource:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr task new <span class="nt">--gen-batch-job-only</span> <span class="nt">-n</span> 2 <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span>
</code></pre></div></div>

<p><strong>Output of “<em>akrr task new –gen-batch-job-only -n 2 -r $RESOURCE -a $APPKER</em>“</strong></p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[INFO] Creating task directory: /home/akrruser/akrr/log/data/ub-hpc/hpcc/2019.03.25.16.01.28.633071
[INFO] Creating task directories: 
        /home/akrruser/akrr/log/data/ub-hpc/hpcc/2019.03.25.16.01.28.633071/jobfiles
        /home/akrruser/akrr/log/data/ub-hpc/hpcc/2019.03.25.16.01.28.633071/proc
[INFO] Creating batch job script and submitting it to remote machine
[INFO] Directory huey:/projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.01.28.633071 does not exists, will try to create it
[INFO] auto_walltime_limit is on, trying to estimate walltime limit...
[INFO] There are only 0 previous run, need at least 5 for walltime limit autoset
[INFO] Local copy of batch job script is /home/akrruser/akrr/log/data/ub-hpc/hpcc/2019.03.25.16.01.28.633071/jobfiles/hpcc.job

[INFO] Application kernel working directory on ub-hpc is /projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.01.28.633071
[INFO] Batch job script location on ub-hpc is /projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.01.28.633071/hpcc.job
</code></pre></div></div>

<p>The output contains the working directory for this task on remote resource. On remote resource get 
to that directory and start interactive session (request same number of nodes, in example above the 
script was generated for 2 nodes).</p>

<p><strong>On remote resource</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#get to working directory</span>
<span class="nb">cd</span> /projects/ccrstaff/general/nikolays/huey/akrr_data/hpcc/2019.03.25.16.01.28.633071
<span class="c">#check hpcc.job is there</span>
<span class="nb">ls</span>
<span class="c">#start interactive session</span>
salloc <span class="nt">--nodes</span><span class="o">=</span>2 <span class="nt">--ntasks-per-node</span><span class="o">=</span>8 <span class="nt">--time</span><span class="o">=</span>01:00:00 <span class="nt">--exclusive</span> <span class="nt">--constraint</span><span class="o">=</span><span class="s2">"CPU-L5520"</span>
<span class="c">#wait till you get access to interactive session</span>
<span class="c">#run ior application kernel</span>
bash hpcc.job

<span class="c"># or submit as normal batch script</span>
sbatch hpcc.job

</code></pre></div></div>

<p>Examine appstdout file, which contains application kernel output (<a href="/AKRR_HPCC_appsout_sample.html">appstdout sample</a>). 
If it looks ok you can move to the next step</p>

<h1 id="perform-validation-run">Perform Validation Run</h1>

<p>On this step application kernel installation on 
the resource is validated. It executes the application kernel and analyses its results. If it fails the problems 
need to be fixed and another round of validation (as detailed above) should be performed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr app validate <span class="nt">-n</span> 2 <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> 
</code></pre></div></div>

<p>See <a href="/AKRR_HPCC_appkernel_validation_sample.html">HPCC validation output sample</a></p>

<h1 id="schedule-regular-execution-of-application-kernel">Schedule regular execution of application kernel.</h1>

<p>Now this application kernel can be submitted for regular execution:</p>

<h1 id="perform-a-test-run-on-all-nodes-count">Perform a test run on all nodes count</h1>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Perform a test run on all nodes count</span>
akrr task new <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-n</span> 1,2,4,8

<span class="c">#Start daily execution from today on nodes 1,2,4,8 and distribute execution time between 1:00 and 5:00</span>
akrr task new <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-n</span> 1,2,4,8 <span class="nt">-t0</span> <span class="s2">"01:00"</span> <span class="nt">-t1</span> <span class="s2">"05:00"</span> <span class="nt">-p</span> 1

<span class="c"># Run on all nodes count 20 times (default number of runs to establish baseline)</span>
akrr task new <span class="nt">-r</span> <span class="nv">$RESOURCE</span> <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-n</span> 1,2,4,8 <span class="nt">--n-runs</span> 20
</code></pre></div></div>

<p>see <a href="/AKRR_Tasks_Scheduling.html">Scheduling and Rescheduling Application Kernels</a> and 
<a href="/AKRR_Walltimelimit_Setting.html">Setup Walltime Limit</a> for more details.</p>

<p>Up: <a href="/AKRR_Deployment_of_Application_Kernel_on_Resource.html">Deployment of Application Kernels on Resource</a></p>

      </div>
      <div class="clear"></div>
    </div>
    <div id="page-footer">
      <a href="https://www.buffalo.edu/ccr" target="_blank"><img src="/xdmod-jekyll-theme/assets/images/ccr_logo.png" alt="Center for Computational Research"/></a>
    </div>
  </div>
</body>
</html>
