<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="utf-8">
  <title>Application Kernel Remote Runner (AKRR) </title>
  <link rel="icon" type="image/x-icon" href="/xdmod-jekyll-theme/assets/images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/xdmod-jekyll-theme/assets/css/effervescence.css" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-44300156-3');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <div id="page-container">
    <div id="page-header">
      <a href="http://open.xdmod.org"><img src="/xdmod-jekyll-theme/assets/images/xdmod_logo.png" alt="XDMoD" /></a>
      <span class="maintitle">Application Kernel Remote Runner (AKRR) Module 2.1.1</span>
    </div>
    
    <div id="page-body">
      <div class="clear"></div>
      <div id="page-menu">
          <div class="page-menu-toc">
        
            
                <h2>About</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/">Overview</a></li>
                            
                    
                    </ul>
                
            
                <h2>Download</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Download.html">Download</a></li>
                            
                    
                    </ul>
                
            
                <h2>Install</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Install.html">Install</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Update.html">Update</a></li>
                            
                    
                    </ul>
                
            
                <h2>Using</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Usage.html">Using</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Add_Resource.html">Adding New Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Deployment_of_Application_Kernel_on_Resource.html">Adding Appkernel to Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NAMD_Deployment.html">Adding NAMD</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCC_Deployment.html">Adding HPCC</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCG_Deployment.html">Adding HPCG</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IMB_Deployment.html">Adding IMB</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IOR_Deployment.html">Adding IOR</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_MDTest_Deployment.html">Adding MDTest</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NWChem_Deployment.html">Adding NWChem</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_GAMESS_Deployment.html">Adding GAMESS</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_ENZO_Deployment.html">Adding ENZO</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Tasks_Scheduling.html">Scheduling Appkernels</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Walltimelimit_Setting.html">Setting AK Walltime</a></li>
                            
                    
                    </ul>
                
            
                <h2>Details</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_HowItWorks.html">How It Works</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Batch_Job_Script_Generation.html">Batch Job Script Generation</a></li>
                            
                    
                    </ul>
                
            
                <h2>Next</h2>
                
                    <ul>
                    
                            
                            <li ><a href="https://appkernels.xdmod.org/">xdmod-appkernels</a></li>
                            
                    
                    </ul>
                
            
        
    </div>
          
        
      </div>
      <div id="page-content">
         <h1></h1> 
        <h2 id="setting-up-hpcg-on-bare-metal-of-openstack">Setting up hpcg on bare metal of openstack</h2>

<p>For this one you do need to install intel mpi and mkl</p>

<p>So in Openstack volume:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        yum-config-manager <span class="nt">--add-repo</span> https://yum.repos.intel.com/mpi/setup/intel-mpi.repo <span class="o">&amp;&amp;</span> <span class="se">\</span>
        rpm <span class="nt">--import</span> https://yum.repos.intel.com/intel-gpg-keys/GPG-PUB-KEY-INTEL-SW-PRODUCTS-2019.PUB <span class="o">&amp;&amp;</span> <span class="se">\</span>
        yum <span class="nt">-y</span> <span class="nb">install </span>intel-mpi-2018.3-051 <span class="o">&amp;&amp;</span> <span class="se">\</span>
        yum-config-manager <span class="nt">--add-repo</span> https://yum.repos.intel.com/mkl/setup/intel-mkl.repo <span class="o">&amp;&amp;</span> <span class="se">\</span>
        yum <span class="nt">-y</span> <span class="nb">install </span>intel-mkl-2018.3-051

</code></pre></div></div>

<p>Then, you need to find the place where the benchmarks are for hpcg. In my case they were in /opt/intel/mkl/benchmarks/hpcg/bin</p>

<p>Also you have to set the lib paths and identify what the libraries are to use, so the following config file was able to handle all of it well.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"""
Resource specific HPCG configuration
"""</span>

appkernel_run_env_template <span class="o">=</span> <span class="s2">"""

# counting if the processor supports avx2 or skx
hpcg_exe_name="</span>xhpcg_avx<span class="s2">"
count_avx2="</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-oc</span> <span class="s1">'avx2'</span> /proc/cpuinfo<span class="si">)</span><span class="s2">"
count_avx512="</span><span class="si">$(</span><span class="nb">grep</span> <span class="nt">-oc</span> <span class="s1">'avx512'</span> /proc/cpuinfo<span class="si">)</span><span class="s2">"
echo "</span>avx2: <span class="nv">$count_avx2</span><span class="s2">"
echo "</span>avx512: <span class="nv">$count_avx512</span><span class="s2">"

# if find any, sets the proper executable name (can still be overriden
if [[ "</span><span class="nv">$count_avx2</span><span class="s2">" -gt "</span>0<span class="s2">" ]]; then
        hpcg_exe_name="</span>xhpcg_avx2<span class="s2">"
fi

if [[ "</span><span class="nv">$count_avx512</span><span class="s2">" -gt "</span>0<span class="s2">" ]]; then
        hpcg_exe_name="</span>xhpcg_skx<span class="s2">"
fi

# set executable location
EXE=/opt/intel/compilers_and_libraries_2018.3.222/linux/mkl/benchmarks/hpcg/bin/</span><span class="nv">$hpcg_exe_name</span><span class="s2">

# so it finds all necessary libraries
export LD_LIBRARY_PATH=/opt/intel/lib/intel64:/opt/intel/mkl/lib/intel64:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">

# Set how to run app kernel
export OMP_NUM_THREADS=1

# need to specify full path bc didn't add mpirun to path
RUN_APPKERNEL="</span>/opt/intel/impi/2018.3.222/bin64/mpirun <span class="nt">-np</span> <span class="nv">$AKRR_CORES</span> <span class="nv">$EXE</span><span class="s2">"
"""</span>
</code></pre></div></div>
<p>Also need to make sure hpcg.dat is in proper location
Run validation and check results files (stdout) to see if it found the input.
If it didn’t find the input you need to get it from the git repo (I don’t think its included in the tar that happens at the deploy step)</p>


      </div>
      <div class="clear"></div>
    </div>
    <div id="page-footer">
      <a href="https://www.buffalo.edu/ccr" target="_blank"><img src="/xdmod-jekyll-theme/assets/images/ccr_logo.png" alt="Center for Computational Research"/></a>
    </div>
  </div>
</body>
</html>
