<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="utf-8">
  <title>Application Kernel Remote Runner (AKRR) </title>
  <link rel="icon" type="image/x-icon" href="/xdmod-jekyll-theme/assets/images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="/xdmod-jekyll-theme/assets/css/effervescence.css" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-44300156-3');
    ga('send', 'pageview');
  </script>
</head>
<body>
  <div id="page-container">
    <div id="page-header">
      <a href="http://open.xdmod.org"><img src="/xdmod-jekyll-theme/assets/images/xdmod_logo.png" alt="XDMoD" /></a>
      <span class="maintitle">Application Kernel Remote Runner (AKRR) Module 2.1.1</span>
    </div>
    
    <div id="page-body">
      <div class="clear"></div>
      <div id="page-menu">
          <div class="page-menu-toc">
        
            
                <h2>About</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/">Overview</a></li>
                            
                    
                    </ul>
                
            
                <h2>Download</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Download.html">Download</a></li>
                            
                    
                    </ul>
                
            
                <h2>Install</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Install.html">Install</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Update.html">Update</a></li>
                            
                    
                    </ul>
                
            
                <h2>Using</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_Usage.html">Using</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Add_Resource.html">Adding New Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Deployment_of_Application_Kernel_on_Resource.html">Adding Appkernel to Resource</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NAMD_Deployment.html">Adding NAMD</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCC_Deployment.html">Adding HPCC</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_HPCG_Deployment.html">Adding HPCG</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IMB_Deployment.html">Adding IMB</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_IOR_Deployment.html">Adding IOR</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_MDTest_Deployment.html">Adding MDTest</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_NWChem_Deployment.html">Adding NWChem</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_GAMESS_Deployment.html">Adding GAMESS</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_ENZO_Deployment.html">Adding ENZO</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Tasks_Scheduling.html">Scheduling Appkernels</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Walltimelimit_Setting.html">Setting AK Walltime</a></li>
                            
                    
                    </ul>
                
            
                <h2>Details</h2>
                
                    <ul>
                    
                            
                            <li ><a href="/AKRR_HowItWorks.html">How It Works</a></li>
                            
                    
                            
                            <li ><a href="/AKRR_Batch_Job_Script_Generation.html">Batch Job Script Generation</a></li>
                            
                    
                    </ul>
                
            
                <h2>Next</h2>
                
                    <ul>
                    
                            
                            <li ><a href="https://appkernels.xdmod.org/">xdmod-appkernels</a></li>
                            
                    
                    </ul>
                
            
        
    </div>
          
        
      </div>
      <div id="page-content">
         <h1></h1> 
        <h2 id="notes-on-deploying-gamess-on-singularity">Notes on deploying gamess on singularity</h2>
<p>Similar to other deployments</p>

<p>(on resource) set up cache directories</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">SINGULARITY_LOCALCACHEDIR</span><span class="o">=</span>/gpfs/scratch/hoffmaps/singularity_images
<span class="nv">SINGULARITY_CACHEDIR</span><span class="o">=</span>/gpfs/scratch/hoffmaps/singularity_images
<span class="nv">SINGULARITY_TMPDIR</span><span class="o">=</span>/gpfs/scratch/hoffmaps/singularity_images

<span class="nb">export </span>SINGULARITY_LOCALCACHEDIR
<span class="nb">export </span>SINGULARITY_CACHEDIR
<span class="nb">export </span>SINGULARITY_TMPDIR

<span class="nb">cd</span> <span class="nv">$SINGULARITY_CACHEDIR</span>

singularity pull <span class="nt">--docker-login</span> docker://pshoff/akrr_benchmarks:gamess

</code></pre></div></div>
<p>Back where akrr is:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">RESOURCE</span><span class="o">=</span>test_huey
<span class="nb">export </span><span class="nv">APPKER</span><span class="o">=</span>gamess

<span class="c"># adding the resource to akrr</span>
akrr app add <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-r</span> <span class="nv">$RESOURCE</span>

<span class="c">#Output </span>
<span class="o">[</span>INFO] Generating application kernel configuration <span class="k">for </span>gamess on test_huey
<span class="o">[</span>INFO] Application kernel configuration <span class="k">for </span>gamess on test_huey is <span class="k">in</span>: 
        /home/hoffmaps/projects/akrr/etc/resources/test_huey/gamess.app.conf
</code></pre></div></div>
<p>Initial gamess.app.conf</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>appkernel_run_env_template <span class="o">=</span> <span class="s2">"""
# Load application enviroment
module load gamess
module list

# set executable location
VERNO=01
EXE=</span><span class="nv">$GAMESS_DIR</span><span class="s2">/gamess.</span><span class="nv">$VERNO</span><span class="s2">.x

# set how to run app kernel
RUN_APPKERNEL="</span><span class="nv">$AKRR_APPKER_DIR</span>/execs/gamess/rungms <span class="nv">$INPUT</span> <span class="nv">$VERNO</span> <span class="nv">$AKRR_NODES</span> <span class="nv">$AKRR_CORES_PER_NODE</span><span class="s2">"
"""</span>
</code></pre></div></div>

<p>Taking our example from the hpcc setup, change it to something like this
(Note: SINGULARITY_IMAGEDIR is wherever your singularity images are, in our case the same as the Singularity Cachedir)</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>appkernel_run_env_template <span class="o">=</span> <span class="s2">"""

export SINGULARITY_IMAGEDIR="</span>/gpfs/scratch/hoffmaps/singularity_images<span class="s2">"
export I_MPI_HYDRA_BOOTSTRAP="</span>ssh<span class="s2">"
unset TMPDIR

# added to deal with temporary working directory error
#export SLURMTMPDIR="</span><span class="nv">$AKRR_TMP_WORKDIR</span><span class="s2">"
unset SLURM_JOB_ID

# set how to run app kernel ( the ppn 8 is temporary, perhaps to change to be general)
RUN_APPKERNEL="</span><span class="nv">$SINGULARITY_IMAGEDIR</span>/akrr_benchmarks_gamess.sif <span class="nt">-ppn</span> 8<span class="s2">"
"""</span>

</code></pre></div></div>
<p>Then we do the standard</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>akrr app validate <span class="nt">-n</span> 1 <span class="nt">-a</span> <span class="nv">$APPKER</span> <span class="nt">-r</span> <span class="nv">$RESOURCE</span>

</code></pre></div></div>
<p>Error’s we’re getting:</p>
<ul>
  <li>permission denied on appsigcheck - that’s just changing permissions on the files locally before copying them into the docker</li>
  <li>can’t crea a file for scratch directory, was tmpdir set or something?
    <ul>
      <li>yeah looks like it looks for the SLURMTMPDIR to be the scratch, so probably want to just set that to the temp directory that we’re using</li>
      <li>seems like best option is doing SLURMTMPDIR=$AKRR_TMP_WORKDIR</li>
    </ul>
  </li>
  <li>So gamess uses srun to start all of its processes…
    <ul>
      <li>So that’s bc it sets the sched to be slurm, based on the existence of SLURM_JOB_ID, so the strat is to unset it and see what happens</li>
    </ul>
  </li>
  <li>Unsetting the id didn’t appear to have any negative repercussions (at least it didn’t give any errors in the validation run)</li>
</ul>


      </div>
      <div class="clear"></div>
    </div>
    <div id="page-footer">
      <a href="https://www.buffalo.edu/ccr" target="_blank"><img src="/xdmod-jekyll-theme/assets/images/ccr_logo.png" alt="Center for Computational Research"/></a>
    </div>
  </div>
</body>
</html>
